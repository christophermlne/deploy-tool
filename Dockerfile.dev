# Development Dockerfile for deploy tool
# Usage: docker build -f Dockerfile.dev -t deploy-dev .
#        docker run -e GITHUB_TOKEN=xxx -e DEPLOY_REPO_URL=xxx deploy-dev mix deploy 123

FROM elixir:1.17-alpine

# Install git (required for repo operations)
RUN apk add --no-cache git

WORKDIR /app

# Copy dependency files first (for layer caching)
COPY mix.exs mix.lock ./

# Install all dependencies (including dev/test)
RUN mix local.hex --force && \
    mix local.rebar --force && \
    mix deps.get

# Copy source code
COPY lib lib
COPY test test
COPY .formatter.exs ./

# Compile the project
RUN mix compile

# Default command shows usage
CMD ["mix", "deploy", "--help"]
